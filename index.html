<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>童话故事集</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700&family=EB+Garamond:ital,wght@0,400;0,700;1,400&display=swap');

        body {
            font-family: 'EB Garamond', serif;
            background-color: #fdf6e3; /* A soft, parchment-like color */
            background-image: url('https://www.toptal.com/designers/subtlepatterns/uploads/old_mathematics.png');
            background-attachment: fixed;
            overflow: hidden;
        }

        .main-title {
            font-family: 'Cinzel Decorative', serif;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .story-list-title {
            font-family: 'Cinzel Decorative', serif;
            font-size: 1.75rem;
            text-align: center;
        }

        #story-list-container {
            background-color: rgba(245, 245, 220, 0.5); /* Semi-transparent beige */
            backdrop-filter: blur(4px);
            border-right: 1px solid rgba(139, 69, 19, 0.2); /* Faint brown border */
        }

        .story-list-item {
            border-radius: 8px;
            font-size: 1.1rem;
            color: #5d4037; /* A deep brown */
            transition: all 0.3s ease;
            border: 1px solid transparent;
        }

        .story-list-item:hover {
            background-color: rgba(218, 165, 32, 0.2); /* Faint goldenrod */
            transform: translateX(5px);
            border-color: rgba(218, 165, 32, 0.4);
        }

        .story-list-item.active {
            background-color: rgba(218, 165, 32, 0.4); /* Goldenrod */
            color: #4e342e;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        #story-content-wrapper {
            background: rgba(253, 246, 227, 0.85); /* Slightly more opaque parchment */
            backdrop-filter: blur(4px);
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            height: calc(100vh - 10rem);
            overflow-y: auto;
            border: 1px solid rgba(255,255,255,0.5);
        }

        #story-content {
            transition: opacity 0.4s ease-in-out;
        }

        /* Custom scrollbar for a more thematic feel */
        #story-content-wrapper::-webkit-scrollbar {
            width: 10px;
        }
        #story-content-wrapper::-webkit-scrollbar-track {
            background: rgba(188, 170, 164, 0.2);
            border-radius: 5px;
        }
        #story-content-wrapper::-webkit-scrollbar-thumb {
            background-color: rgba(139, 69, 19, 0.4); /* SaddleBrown, semi-transparent */
            border-radius: 5px;
            border: 2px solid transparent;
            background-clip: content-box;
        }
        #story-content-wrapper::-webkit-scrollbar-thumb:hover {
            background-color: rgba(139, 69, 19, 0.6);
        }

        /* Styles for the content loaded from story files */
        .story-header {
            text-align: center;
            margin-bottom: 2rem;
            border-bottom: 1px dashed rgba(139, 69, 19, 0.3);
            padding-bottom: 1rem;
        }
        .story-title {
            font-family: 'EB Garamond', serif;
            font-weight: 700;
            font-size: 2.5rem;
            color: #5d4037;
        }
        .story-subtitle {
            font-size: 1.1rem;
            color: #8d6e63;
            font-style: italic;
            margin-top: 0.5rem;
        }
        .story-body {
            line-height: 1.8;
            font-size: 1.1rem;
        }

    </style>
</head>
<body class="text-stone-800">

    <div class="flex flex-col h-screen">
        <header class="text-center py-6 px-8 z-10">
            <h1 class="main-title text-5xl md:text-6xl font-bold text-stone-800/90">我的童话故事集</h1>
        </header>

        <div class="flex flex-1 overflow-hidden px-4 pb-4 md:px-8 md:pb-8">
            <aside id="story-list-container" class="w-1/3 p-6 overflow-y-auto rounded-l-lg">
                <h2 class="story-list-title text-stone-700 mb-6">故事列表</h2>
                <ul id="story-list" class="space-y-3">
                    <!-- Story list generated by JS -->
                </ul>
            </aside>

            <main class="w-2/3" id="story-main-content">
                 <div id="story-content-wrapper" class="p-8 md:p-12">
                    <div id="story-content">
                        <div class="flex items-center justify-center h-full">
                            <p class="text-2xl text-gray-500">请从左侧选择一个故事来阅读</p>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const storyListElement = document.getElementById('story-list');
            const storyContentElement = document.getElementById('story-content');

            async function initialize() {
                try {
                    const response = await fetch('stories.json');
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    const stories = await response.json();

                    stories.forEach(story => {
                        const listItem = document.createElement('li');
                        listItem.innerHTML = `<a href="#" class="block p-4 story-list-item" data-story-file="${story.file}">${story.title}</a>`;
                        storyListElement.appendChild(listItem);
                    });

                    storyListElement.addEventListener('click', (event) => {
                        event.preventDefault();
                        const target = event.target.closest('.story-list-item');

                        if (target) {
                            document.querySelectorAll('.story-list-item').forEach(item => item.classList.remove('active'));
                            target.classList.add('active');
                            const storyFile = target.dataset.storyFile;
                            loadStory(storyFile);
                        }
                    });

                    if (stories.length > 0) {
                        const firstStoryItem = storyListElement.querySelector('.story-list-item');
                        if (firstStoryItem) {
                            firstStoryItem.classList.add('active');
                            loadStory(stories[0].file);
                        }
                    }

                } catch (error) {
                    console.error('无法加载故事列表:', error);
                    storyListElement.innerHTML = `<li class="text-red-600 p-4">加载故事列表失败。</li>`;
                }
            }

            async function loadStory(fileName) {
                storyContentElement.style.opacity = 0;
                
                // Show loading indicator after a short delay
                const loadingTimeout = setTimeout(() => {
                    storyContentElement.innerHTML = '<div class="flex items-center justify-center h-full"><p class="text-xl text-stone-500 animate-pulse">正在加载故事...</p></div>';
                    storyContentElement.style.opacity = 1;
                }, 200);

                try {
                    const response = await fetch(`story/${fileName}`);
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    const markdownContent = await response.text();
                    
                    // 提取第一行为标题，第二行为副标题
                    const lines = markdownContent.split('
');
                    const title = lines[0].replace(/^#\s*/, '');
                    const subtitle = lines[1];
                    const body = lines.slice(2).join('
');

                    clearTimeout(loadingTimeout);

                    setTimeout(() => {
                        const storyHTML = `
                            <header class="story-header">
                                <h1 class="story-title">${title}</h1>
                                <p class="story-subtitle">${subtitle}</p>
                            </header>
                            <main>
                                <div class="story-body">${marked.parse(body)}</div>
                            </main>
                        `;
                        storyContentElement.innerHTML = storyHTML;
                        storyContentElement.style.opacity = 1;
                    }, 50);

                } catch (error) {
                    clearTimeout(loadingTimeout);
                    console.error('加载故事时出错:', error);
                    storyContentElement.innerHTML = `<div class="text-red-600">加载故事失败，请检查控制台获取更多信息。</div>`;
                    storyContentElement.style.opacity = 1;
                }
            }

            initialize();
        });
    </script>
</body>
</html>
